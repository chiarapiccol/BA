---
title: "Part 1"
output: html_notebook
---

In this script the following goals are to be pursued:
1. # packages
2. # import the tables (#2.1 Import BKA and #2.2 Import SO)
3. # adjust the tables (#3.1 adjust BKA and #3.2 adjust SO)
4. # descriptive statistics and annotation of possible modifications( 3_kompletteAnalyseINTERPOL, 2_kompletteAnalysePOPRELATION)
5. # Analysis (#5.1 create Dataframe and #5.2 Analysis and #5.3 Tests)


# 1. Packages

```{r}
library("tidyverse")
library("haven")
library("dplyr")
library("readxl")
library("plyr")
library("ggplot2")
library("reshape2")
library("stringi")
#install.packages("Synth")
library("Synth")
#install.packages("zoo")
library("zoo")
```

# 2. Import of the tables 
In this section, the data tables from BKA and GESIS are imported and adjusted to create data frames suitable for descriptive statistics

### 2.1 Import BKA  

```{r}
LF2013 <- read_excel("2013_LF.xlsx")
LF2014 <- read_excel("2014_LF.xlsx")
LF2015 <- read_excel("2015_LF.xlsx")
LF2016 <- read_excel("2016_LF.xlsx")
LF2017 <- read_excel("2017_LF.xlsx")
LF2018 <- read_excel("2018_LF.xlsx")
LF2019 <- read_excel("2019_LF.xlsx")
LF2020 <- read_excel("2020_LF.xlsx")

```

### 2.2 Import SO

```{r}
BeschArOrt <- read_excel("BeschamArOrt.xlsx")
BeschWohnOrt <- read_excel("BeschWohnOrt.xlsx")
BevDeutAus <- read_excel("Bev_Deut_Aus.xlsx")
BodenFlsch <- read_excel("Bodenflaesche.xlsx")
ErwerbAbsc <- read_excel("ERwerbmitAbsc.xlsx")
Flsch <- read_excel("Flaesche.xlsx")
SGB <- read_excel("SGB.xlsx") 
Wahl <- read_excel("Wahl.xlsx")
Geburt <- read_excel("Geburt.xlsx")
Alter <-  read_excel("Alter.xlsx")
Raum <- read_excel("Raum.xlsx")
ErwbWZ <- read_excel("ErwbWZ.xlsx")
Gini <- read_excel("Gini.xlsx")
Arbeitslosen <- read_excel("Arbeitslosen.xlsx")
Bevolk <- read_excel("Bevolk.xlsx")

```

# 3. Adjust the data for the execution of the descriptive statistics

### 3.1 adjust BKA Data

- Create new variable "Jahr". This column specifies the year
```{r}
LF2013["Jahr"] <- 2013
LF2014["Jahr"] <- 2014
LF2015["Jahr"] <- 2015
LF2016["Jahr"] <- 2016
LF2017["Jahr"] <- 2017
LF2018["Jahr"] <- 2018
LF2019["Jahr"] <- 2019
LF2020["Jahr"] <- 2020
```

- Create new dataframe by merging the BKA table. We use this table to build the descriptive statistics, since it is in a long format
```{r}
LF <- plyr::rbind.fill(LF2013, LF2014, LF2015,LF2016, LF2017, LF2018,LF2019, LF2020 )
```

- Rename values of the Variable "Bundesland". Rename the variable´s values in order to have the same name "Deut" instead of "Bund echte Zählung der Tatverdächtigen" or "Bundesrepublik Deutschland"
```{r}
LF$Bundesland <- ifelse(LF$Bundesland == "Bund echte Zählung der Tatverdächtigen" |LF$Bundesland == "Bundesrepublik Deutschland", "Deut", LF$Bundesland )
### check
unique(LF$Bundesland)
```

- Create a new Variable: Provide a number as identifier for each region
Create a new variable which gives every Bundesland an ID. Starting with Bayern as 1 and ending with the regions without treatment from 9 to 16
```{r}
# sorted first by region and by time-period
LF <- LF %>% arrange(Bundesland, Jahr)

# IDs
unique(LF$Bundesland)
unique(LF$Jahr)
LF$IDbl <- NA
LF$IDbl <- ifelse(LF$Bundesland == "Bayern","1", LF$IDbl )
LF$IDbl <- ifelse(LF$Bundesland == "Brandenburg","2", LF$IDbl )
LF$IDbl <- ifelse(LF$Bundesland == "Sachsen-Anhalt","3", LF$IDbl )
LF$IDbl <- ifelse(LF$Bundesland == "Hamburg","4", LF$IDbl )
LF$IDbl <- ifelse(LF$Bundesland == "Hessen","5", LF$IDbl )
LF$IDbl <- ifelse(LF$Bundesland == "Niedersachsen","6", LF$IDbl )
LF$IDbl <- ifelse(LF$Bundesland == "Nordrhein-Westfalen","7", LF$IDbl )
LF$IDbl <- ifelse(LF$Bundesland == "Sachsen","8", LF$IDbl )
LF$IDbl <- ifelse(LF$Bundesland == "Bremen","9", LF$IDbl )
LF$IDbl <- ifelse(LF$Bundesland == "Baden-Württemberg","10", LF$IDbl )
LF$IDbl <- ifelse(LF$Bundesland == "Mecklenburg-Vorpommern","11", LF$IDbl )
LF$IDbl <- ifelse(LF$Bundesland == "Rheinland-Pfalz","12", LF$IDbl )
LF$IDbl <- ifelse(LF$Bundesland == "Saarland","13", LF$IDbl )
LF$IDbl <- ifelse(LF$Bundesland == "Berlin","14", LF$IDbl )
LF$IDbl <- ifelse(LF$Bundesland == "Schleswig-Holstein","15", LF$IDbl )
LF$IDbl <- ifelse(LF$Bundesland == "Thüringen","16", LF$IDbl )
LF$IDbl <- as.numeric(LF$IDbl)

#check 
select(LF, Bundesland, IDbl)%>%View()
select(LF, Bundesland, IDbl)%>%table()
```

- Create three new variables "TG_KG".
"TG_KG" gives every Bundesland a class (0,1,2,3,4) according to when the Bundesländer made the policy reform (0= Bayern(TG), 1=2018, 2=2019, 3=2020, 4=2021 or never). Information are in the excel-file Länder-Gesetze. 
These other two variables "TG_CG2019" and "TG_CG2020" identify with the value 1 the Bundesländer which got the treatment in the respective years and with the value 0 the ones which did not
```{r}
# create new variables TG_CG
LF["TG_KG"] <- NA
LF$TG_KG <- ifelse(LF$Bundesland == "Bayern",
                   "0", LF$TG_KG )
LF$TG_KG <- ifelse(LF$Bundesland == "Hessen"|
                   LF$Bundesland == "Nordrhein-Westfalen"|
                   LF$Bundesland == "Sachsen"|
                   LF$Bundesland == "Sachsen-Anhalt",
                   "1", LF$TG_KG )
LF$TG_KG <- ifelse(LF$Bundesland == "Brandenburg"|
                   LF$Bundesland == "Hamburg"|
                   LF$Bundesland == "Niedersachsen",
                   "2", LF$TG_KG )
LF$TG_KG <- ifelse(LF$Bundesland == "Baden-Württemberg"|
                   LF$Bundesland == "Bremen"|
                   LF$Bundesland == "Mecklenburg-Vorpommern"|
                   LF$Bundesland == "Rheinland-Pfalz"|
                   LF$Bundesland == "Saarland",
                   "3", LF$TG_KG )
LF$TG_KG <- ifelse(LF$Bundesland == "Thüringen"|
                   LF$Bundesland == "Schleswig-Holstein"|
                   LF$Bundesland == "Berlin",
                   "4", LF$TG_KG )
### check
select(LF, Bundesland, TG_KG)%>%View()

# create new variables TG_CG2019, TG_CG2020
LF["TG_CG2019"] <- NA
LF["TG_CG2020"] <- NA
LF$TG_CG2019 <- ifelse(LF$Bundesland == "Bayern","1", LF$TG_CG2019 )
LF$TG_CG2019 <- ifelse(
  LF$Bundesland == "Thüringen" |
  LF$Bundesland == "Schleswig-Holstein" | 
  LF$Bundesland == "Berlin","0", LF$TG_CG2019 )
  LF$TG_CG2019 <- as.numeric(LF$TG_CG2019)

LF$TG_CG2020 <- ifelse(LF$Bundesland == "Bayern","1", LF$TG_CG2020 )
LF$TG_CG2020 <- ifelse(
  LF$Bundesland == "Thüringen" |
  LF$Bundesland == "Schleswig-Holstein" | 
  LF$Bundesland == "Berlin"|
  LF$Bundesland == "Saarland"|
  LF$Bundesland == "Rheinland-Pfalz"|
  LF$Bundesland == "Mecklenburg-Vorpommern"|
  LF$Bundesland == "Bremen"|
  LF$Bundesland == "Baden-Württemberg","0", LF$TG_CG2020 )
  LF$TG_CG2020 <- as.numeric(LF$TG_CG2020)

### check
select(LF, Bundesland, TG_CG2019 )%>%table(useNA="always")
select(LF, Bundesland, TG_CG2020 )%>%table(useNA="always")
```

- Create new variable "StraftatGruppe". Regroup the Straftaten typologies according to the PDF-file Interpretationshilfe-BKA. 
```{r}
LF["StraftatGruppe"] <- NA
LF$StraftatGruppe <- ifelse(stri_extract_first_regex(LF$IDStraftat, ".{1}") == "-", "Straft.Insg.", LF$StraftatGruppe )
LF$StraftatGruppe <- ifelse(stri_extract_first_regex(LF$IDStraftat, ".{1}") == "0", "Straf.ggLeben", LF$StraftatGruppe )
LF$StraftatGruppe <- ifelse(stri_extract_first_regex(LF$IDStraftat, ".{1}") == "1", "Straft.ggSex.Selbstbest.", LF$StraftatGruppe )
LF$StraftatGruppe <- ifelse(stri_extract_first_regex(LF$IDStraftat, ".{1}") == "2", "Straft.ggPers.Freiheit", LF$StraftatGruppe )
LF$StraftatGruppe <- ifelse(stri_extract_first_regex(LF$IDStraftat, ".{1}") == "3", "Diebstahl", LF$StraftatGruppe )
LF$StraftatGruppe <- ifelse(stri_extract_first_regex(LF$IDStraftat, ".{1}") == "4", "Diebstahl", LF$StraftatGruppe )
LF$StraftatGruppe <- ifelse(stri_extract_first_regex(LF$IDStraftat, ".{1}") == "*", "Diebstahl", LF$StraftatGruppe )
LF$StraftatGruppe <- ifelse(stri_extract_first_regex(LF$IDStraftat, ".{1}") == "5", "Verm.Fälschung.Del.", LF$StraftatGruppe )
LF$StraftatGruppe <- ifelse(stri_extract_first_regex(LF$IDStraftat, ".{1}") == "6", "Sonst.Straftatbest.", LF$StraftatGruppe )
LF$StraftatGruppe <- ifelse(stri_extract_first_regex(LF$IDStraftat, ".{1}") == "7", "Strafrecht.Nebenges", LF$StraftatGruppe )
LF$StraftatGruppe <- ifelse(stri_extract_first_regex(LF$IDStraftat, ".{1}") == "8", "Strafrecht.Nebenges", LF$StraftatGruppe )
LF$StraftatGruppe <- ifelse(stri_extract_first_regex(LF$IDStraftat, ".{1}") == "9", "Strafrecht.Nebenges", LF$StraftatGruppe )
### check
view(select(LF,StraftatGruppe, Straftat,IDStraftat ))

```


### 3.2 adjust SO Data

- adjust Table "ErwerbAbsc". Split a variable into four variables in order to divide the data only by "Jahr" and "Bundesland" and to have 128 observations
```{r}
view(ErwerbAbsc)

I <- filter(ErwerbAbsc, Abschluss == "Insgesamt" )
oB <- filter(ErwerbAbsc, Abschluss == "ohne Berufsabschluss" )
mA <- filter(ErwerbAbsc, Abschluss == "mit akademischem Abschluss" )
mB <- filter(ErwerbAbsc, Abschluss == "mit anerkanntem Berufsabschluss" )

I <- rename(I,c('Insgesamt'='ErwerbInsgesamt'))
oB <- rename(oB,c('Insgesamt'='ErwerbOhneBerAbsch'))
mA<- rename(mA,c('Insgesamt'='ErwerbMitAkaAbsch'))
mB <- rename(mB,c('Insgesamt'='ErwerbMitBerAbsch'))

I[3] <- NULL  
oB[3] <- NULL  
mA[3] <- NULL  
mB[3] <- NULL

ErwerbAbsc <- Reduce(inner_join, list(I, oB, mB,mA))

###check 
view(ErwerbAbsc)
```

- adjust Table "Alter". Extract only the relevant information, which are People under 18 and People between 25 and 30 years.
```{r}
View(Alter)
Alter <- subset(Alter, Alter != "Insgesamt")
Alter$AlterZahl <- as.numeric(gsub(".*?([0-9]+).*$", "\\1", Alter$Alter))
A18 <- filter(Alter, AlterZahl <= 19 )
A2530 <- filter(Alter, AlterZahl <= 31 & AlterZahl >= 25)

A18[2] <- NULL  
A18[4] <- NULL
A2530[2] <- NULL
A2530[4] <- NULL

A18 <- aggregate(A18$Bevölkerung, by=list(Bundesland=A18$Bundesland), FUN=sum)
A2530 <- aggregate(A2530$Bevölkerung, by=list(Bundesland=A2530$Bundesland), FUN=sum)

A18<- rename(A18,c('x'='bis18J'))
A2530 <- rename(A2530,c('x'='von25bis30J'))

Alter <- Reduce(inner_join, list(A18, A2530))
Alter$Jahr <- 2013

### check
View(Alter)
```

- adjust table "ErwbWZ" .  Split a variable into five variables in order to divide the data only by "Jahr" and "Bundesland" and to have 128 observations 
```{r}
view(ErwbWZ)

ErwbWZDienst <- filter(ErwbWZ, WZ == "Dienstleistungsbereiche" )
ErwbWZIns <- filter(ErwbWZ, WZ == "Insgesamt" )

ErwbWZDienst[2] <- NULL  
ErwbWZIns[2] <- NULL

ErwbWZDienst <- rename(ErwbWZDienst,c('Erwerbstätige'='ErwbWZDienst'))
ErwbWZIns <- rename(ErwbWZIns,c('Erwerbstätige'='ErwbWZIns'))

ErwbWZ <- Reduce(inner_join, list(ErwbWZDienst, ErwbWZIns))

###check 
view(ErwbWZ)
```

- Create new dataframe "LSO" by merging the SO table. We use this table to build the descriptive statistics. 
```{r}

LSO <- dplyr::left_join(BeschArOrt, BeschWohnOrt, by=c("Bundesland", "Jahr"))
LSO <- dplyr::left_join(LSO, BevDeutAus, by=c("Bundesland", "Jahr"))
LSO <- dplyr::left_join(LSO, BodenFlsch, by=c("Bundesland", "Jahr"))
LSO <- dplyr::left_join(LSO, ErwerbAbsc, by=c("Bundesland", "Jahr"))
LSO <- dplyr::left_join(LSO, Flsch, by=c("Bundesland", "Jahr"))
LSO <- dplyr::left_join(LSO, SGB, by=c("Bundesland", "Jahr"))
LSO <- dplyr::left_join(LSO, Wahl, by=c("Bundesland", "Jahr"))
LSO <- dplyr::left_join(LSO, Geburt, by=c("Bundesland", "Jahr"))
LSO <- dplyr::left_join(LSO, Alter, by=c("Bundesland", "Jahr"))
LSO <- dplyr::left_join(LSO, ErwbWZ, by=c("Bundesland", "Jahr"))
LSO <- dplyr::left_join(LSO, Raum, by=c("Bundesland", "Jahr"))
LSO <- dplyr::left_join(LSO, Gini, by=c("Bundesland", "Jahr"))
LSO <- dplyr::left_join(LSO, Arbeitslosen, by=c("Bundesland", "Jahr"))
LSO <- dplyr::left_join(LSO, Bevolk, by=c("Bundesland", "Jahr"))

#check
view(LSO)
unique(LSO$Bundesland)
unique(LSO$Jahr)
```

- Create new Variables - Proxyvariables- for the analysis.

```{r}
# dataframe
LSO <- LSO%>%
  mutate("ArbeitslosenQuote" = ArbeitslosenQuote_Erwerb,
         "Gini" = Gini,
         "WahlBet" =  TeilWahlbeteiligung,
         #Ausländeranteil
         "AusländerTeil"=AusländerIns/BevölkAnzahl*100,
         #Fertilität
         "FertiliaetTeil"=Geburt/BevölkAnzahl*100, 
         #Wohnfläche per Einwohner in m²
         "Dichte"=`BevölkDichte`, 
         #Anteil der Siedlungs- und Verkehrsfläche
         "SiedVerkFlschTeil" = (SiedlungIns + VerkehrIns)/BodenFlaescheIns*100,
         #Anteil der Stimmen für die Parteien Grüne
         "GrueneTeil" = GRÜNE/ZweitStimme*100,
         #Anteil der Stimmen für die Parteien FDP,
         "FDPTeil" = FDP/ZweitStimme*100, 
         #Anteil der Stimmen für die Parteien Linke,
         "LinkeTeil" = DIELINKE/ZweitStimme*100, 
         #Anteil der Arbeitslosengeld II-Empfänger
         "SGBXIITeil" = Leistungsempfaenger_SGBXII/BevölkAnzahl*100,
         #Anteil der Beschäftigten mit Hochschulabschluss
         "ErwerbMitAkaAbschTeil" = ErwerbMitAkaAbsch/ErwerbInsgesamt*100,
         #Anteil der Beschäftigten in der Dienstleistungsbranche
         "ErwerbDienstTeil" = as.numeric(ErwbWZDienst)/as.numeric(ErwbWZIns)*100,
         #Anzahl der Personen pro Wohnung
         "WohnEinw" = BevölkAnzahl/WohnINs,
         # Anteil an 25- bis 30-jährigen
         "von25bis30JTeil" = von25bis30J/BevölkAnzahl*100,
         #Anteil der Bevölkerung unter 18 Jahren
         "bis18JTeil" = bis18J/BevölkAnzahl*100,
         #Anteil der Wohnungen mit einem oder zwei Zimmern
         "ZweiZimmerTeil" = `2Raeume`/WohnINs*100,
         #Anteil der Arbeits- in Vergleich zu Wohnortsbeschäftigten,
         "BeschAoWoTeil" =BeschAmArbOrt/(BeschamWohnOrt+BeschAmArbOrt)*100
         )
###check
view(LSO)
```


### 3 descriptive statistics

Before we create the "BKA" dataframe that we use for our analysis, a better overview of the data is needed and if necessary the data will be cleaned. 

### 3.1 descriptive statistics bevor adjusting 

```{r}
# development of Bundesländer 
### the development of Straftaten-Insgesamt over the years for Deut 
DS0 <- LF%>%filter(Straftat == "Straftaten insgesamt" & Bundesland == "Deut")
GG0.1 <- ggplot(DS0, aes(Jahr, AnErfFaelle))+geom_line()+ylim(4000000, 7000000)+ ggtitle("Entwiklung der Straftaten insgesamt in Deutschland von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der Straftaten insgesamt")
GG0.1
GG0.2 <- ggplot(DS0, aes(Jahr, AnVersuche))+geom_line()+ylim(350000, 550000)+ ggtitle("Entwiklung der Versuche insgesamtin Deutschland von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der Versuche insgesamt")
GG0.2
GG0.3 <- ggplot(DS0, aes(Jahr, TeilVersuche)) +geom_line()+ylim(0, 10)+ ggtitle("Entwiklung der Versuche insgesamtin Deutschland von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der Versuche insgesamt")
GG0.3
GG0.4 <- ggplot(DS0, aes(Jahr, AnAufkl))+geom_line()+ylim(3000000, 4000000)+ ggtitle("Entwiklung der aufgeklärten Fälle insgesamt in Deutschland von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der aufgeklärten Fälle")
GG0.4
GG0.5 <- ggplot(DS0, aes(Jahr, TeilAufkl)) +geom_line()+ylim(0, 100)+ ggtitle("Entwiklung der aufgeklärten Fälle insgesamt in Deutschland von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der Versuche insgesamt")
GG0.5
```

RESULTS:
GG0.1: die Anzahl der Straftaten insgesamt nimmt mit der Zeit ab, mit einer Ausnahme von 2015
GG0.2: die Anzahl der Versuche insgesamt nimmt mit der Zeit ab, mit einer Ausnahme von 2015
GG0.3: der Anteil der Versuche insgesamt bleibt stabil über der Zeit
GG0.4: die Anzahl der aufgeklärten Fällen insgesamt nimmt mit der Zeit ab, mit einer Ausnahme von 2015
GG0.5:  der Anteil der Versuche insgesamt bleibt relativ stabil bzw. steigt schwach über der Zeit

Anzahl: sinkt, mit Ausnamhe von 2015
Anteil: bleicbt stebil

```{r}
###  for each Bundesland the development of Straftaten-Insgesamt over the years(with Deut and without Deut)

DS1.1 <- LF%>%filter(Straftat == "Straftaten insgesamt")
GG1.1 <- ggplot(DS1.1, aes(x=Jahr, y=AnErfFaelle, colour = Bundesland, group=Bundesland))+ geom_line()+ ggtitle("Entwiklung der Straftaten insgesamt in deutschen Bundesländer von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der Straftaten insgesamt")
GG1.1

DS1.2 <- LF%>%filter(Straftat == "Straftaten insgesamt" & Bundesland != "Deut")
GG1.2 <- ggplot(DS1.2, aes(x=Jahr, y=AnErfFaelle, colour = Bundesland, group=Bundesland))+ geom_line()+ ggtitle("Entwiklung der Straftaten insgesamt in deutschen Bundesländer von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der Straftaten insgesamt")
GG1.2
GG1.3 <- ggplot(DS1.2, aes(x=Jahr, y=AnErfFaelle, colour = TG_KG, group=Bundesland))+ geom_line()+ ggtitle("Entwiklung der Straftaten insgesamt in deutschen Bundesländer von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der Straftaten insgesamt")
GG1.3
GG1.4 <- ggplot(DS1.2, aes(x=Jahr, y=AnErfFaelle, colour = TG_KG, group=Bundesland))+ geom_line()+scale_color_manual(values = c('red','gray62','gray62','seagreen3', 'seagreen4'))+ ggtitle("Entwiklung der Straftaten insgesamt in deutschen Bundesländer von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der Straftaten insgesamt")
GG1.4

```

RESULTS:
GG1.1: siehe oben
DS1.2: Alle Länder haben eine stabilen Verlauf, außer NRW und Bayern. NRW hat die gröste Anzahl der Straftaten insgesamt, steigt bei dem Jahr 2015, sinkt bei allen anderen Jahren sehr stark. Bayern steigt im 2015 und sinkt wieder sehr stark.
GG1.3 und GG1.4: Die Vertilung von den Gruppen folgt keinem Muster. Mann könnte vermuten, dass die Gruppe 3 und 4 eher in der unteren Häften während die Gruppe 0,1 und 2 sich bei der oberen Hälfte bewegen. 

NB: Intepolation for the year 2015 and calculatio of the Straftat in relation with Population is needed --> 3_kompletteAnalyseINTERPOL, 2_kompletteAnalysePOPRELATION


For Bundesländer NRW and Bayern:
```{r}
#  for the Bundesländer NRW and Bayern the development of Straftaten over the years
### overview on Straftaten for Bayern and NRW 
DS7 <- LF%>%filter(IDStraftat =="000000"|  
                      IDStraftat =="100000"| 
                      IDStraftat =="200000"|  
                      IDStraftat =="****00"| 
                      IDStraftat =="500000"| 
                      IDStraftat =="600000"| 
                      IDStraftat =="700000")
DS7.1 <- DS7%>%filter(Bundesland =="Bayern")
GG7.1<- ggplot(DS7.1, aes(x=Jahr, y=AnErfFaelle, colour = StraftatGruppe, group=IDStraftat))+ geom_line()+ ggtitle("Entwiklung der Straftaten insgesamt in Bayern von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der Straftaten insgesamt ")
GG7.1
DS7.2 <- DS7%>%filter(Bundesland =="Nordrhein-Westfalen")
GG7.2<- ggplot(DS7.2, aes(x=Jahr, y=AnErfFaelle, colour = StraftatGruppe, group=IDStraftat))+ geom_line()+ ggtitle("Entwiklung der Straftaten insgesamt in NRW von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der Straftaten insgesamt ")
GG7.2

### for Bayern more details 
DS7.3 <- LF%>%filter(StraftatGruppe == "Strafrechtliche Nebengesetze" & Bundesland =="Bayern" & Jahr == "2015")
mostCommBayStraf <-  top_n(DS7.3, 15, AnErfFaelle)
mostCommBayStrafID <- mostCommBayStraf$IDStraftat
DS7.4 <- LF%>%filter(StraftatGruppe == "Strafrechtliche Nebengesetze" & Bundesland =="Bayern")
out <- subset(DS7.4, IDStraftat %in% mostCommBayStrafID)
GG7.4<- ggplot(out, aes(x=Jahr, y=AnErfFaelle, colour = IDStraftat, group=IDStraftat))+ geom_line()+ ggtitle("Entwiklung der häufigsten Strafrechtliche Nebengesetze in Deutschland von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der Straftaten insgesamt ")
GG7.4
```

RESULTATE:
GG7.1. Strafrechtliche Nebengesetze haben eine sehr starken Einfluss auf den Verlauf der Kurve bei Bayern. 
GG7.4: Inbesondere die Straftaten in Verbindung mit Unerlaubte Einreise und Aufenthalt beeinflußen die Kurve. 

NB: Intepolation for the year 2015 is needed --> 3_kompletteAnalyseINTERPOL

```{r}
###  for each Bundesland the development of Versuche over the years(with Deut and without Deut)

DS2.1 <- LF%>%filter(Straftat == "Straftaten insgesamt")
GG2.1 <- ggplot(DS2.1, aes(x=Jahr, y=AnVersuche, colour = Bundesland, group=Bundesland))+ geom_line()+ ggtitle("Entwiklung der Versuche insgesamt in deutschen Bundesländer von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der Versuche insgesamt")
GG2.1

DS2.2 <- LF%>%filter(Straftat == "Straftaten insgesamt" & Bundesland != "Deut")
GG2.2 <- ggplot(DS2.2, aes(x=Jahr, y=AnVersuche, colour = Bundesland, group=Bundesland))+ geom_line()+ ggtitle("Entwiklung der Versuche insgesamt in deutschen Bundesländer von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der Versuche insgesamt")
GG2.2
GG2.3 <- ggplot(DS2.2, aes(x=Jahr, y=AnVersuche, colour = TG_KG, group=Bundesland))+ geom_line()+ ggtitle("Entwiklung der Versuche insgesamt in deutschen Bundesländer von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der Versuche insgesamt")
GG2.3
GG2.4 <- ggplot(DS2.2, aes(x=Jahr, y=AnVersuche, colour = TG_KG, group=Bundesland))+ geom_line()+scale_color_manual(values = c('red','gray62','gray62','seagreen3', 'seagreen4'))+ ggtitle("Entwiklung der Versuche insgesamt in deutschen Bundesländer von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der Versuche insgesamt")
GG2.4
```

RESULTS:
GG2.1 und DS2.2: Alle Länder haben eine stabilen Verlauf, außer NRW und Bayern. NRW hat die gröste Anzahl der Versuche insgesamt, steigt bei dem Jahr 2015, sinkt bei allen anderen Jahren sehr stark. Bayern steigt abdem Jahr 2015 und sinkt wieder um 2018.
GG2.3 und GG2.4: Die Vertilung von den Gruppen folgt keinem Muster. Mann könnte vermuten, dass die Gruppe 3 und 4 eher in der unteren Häften während die Gruppe 0,1 und 2 sich bei der oberen Hälfte bewegen.


```{r}
###  for each Bundesland the development of Versuche over the years(with Deut and without Deut)

DS3.1 <- LF%>%filter(Straftat == "Straftaten insgesamt")
GG3.1 <- ggplot(DS3.1, aes(x=Jahr, y=TeilVersuche, colour = Bundesland, group=Bundesland))+ geom_line()+ ggtitle("Entwiklung der Versuche Anteil in deutschen Bundesländer von 2013 bis 2020") +  xlab("Jahre") + ylab("Anteil der Versuche insgesamt")
GG3.1

DS3.2 <- LF%>%filter(Straftat == "Straftaten insgesamt" & Bundesland != "Deut")
GG3.2 <- ggplot(DS3.2, aes(x=Jahr, y=TeilVersuche, colour = Bundesland, group=Bundesland))+ geom_line()+ ggtitle("Entwiklung der Versuche Anteil in deutschen Bundesländer von 2013 bis 2020") +  xlab("Jahre") + ylab("Anteil der Versuche insgesamt")
GG3.2
GG3.3 <- ggplot(DS3.2, aes(x=Jahr, y=TeilVersuche, colour = TG_KG, group=Bundesland))+ geom_line()+ ggtitle("Entwiklung der Versuche Anteil in deutschen Bundesländer von 2013 bis 2020") +  xlab("Jahre") + ylab("Anteil der Versuche insgesamt")
GG3.3
GG3.4 <- ggplot(DS3.2, aes(x=Jahr, y=TeilVersuche, colour = TG_KG, group=Bundesland))+ geom_line()+scale_color_manual(values = c('red','gray62','gray62','seagreen3', 'seagreen4'))+ ggtitle("Entwiklung der Versuche Anteil in deutschen Bundesländer von 2013 bis 2020") +  xlab("Jahre") + ylab("Anteil der Versuche insgesamt")
GG3.4
```

RESULTS:
GG3.1 und DS3.2: Alle Länder haben einen unstabilen Verlauf, darunter auch Bayern. Bayern sinkt in dem Jahr 2014 und steigt wieder ab 2017 wo es relativ stabil bleicbt.
GG3.3 und GG34: Die Vertilung von den Gruppen folgt keinem Muster. 

```{r}
###  for each Bundesland the development of Erklärung over the years(with Deut and without Deut)
DS4.1 <- LF%>%filter(Straftat == "Straftaten insgesamt")
GG4.1 <- ggplot(DS4.1, aes(x=Jahr, y=AnAufkl, colour = Bundesland, group=Bundesland))+ geom_line()+ ggtitle("Entwiklung der erklärten Fälle insgesamt in deutschen Bundesländer von 2013 bis 2020") +  xlab("Jahre") + ylab("Zahl der erklärten Fälle insgesamt")
GG4.1

DS4.2 <- LF%>%filter(Straftat == "Straftaten insgesamt" & Bundesland != "Deut")
GG4.2 <- ggplot(DS4.2, aes(x=Jahr, y=AnAufkl, colour = Bundesland, group=Bundesland))+ geom_line()+ ggtitle("Entwiklung der erklärten Fälle insgesamt in deutschen Bundesländer von 2013 bis 2020") +  xlab("Jahre") + ylab("Zahl der erklärten Fälle insgesamt")
GG4.2
GG4.3 <- ggplot(DS4.2, aes(x=Jahr, y=AnAufkl, colour = TG_KG, group=Bundesland))+ geom_line()+ ggtitle("Entwiklung der erklärten Fälle insgesamt in deutschen Bundesländer von 2013 bis 2020") +  xlab("Jahre") + ylab("Zahl der erklärten Fälle insgesamt")
GG4.3
GG4.4 <- ggplot(DS4.2, aes(x=Jahr, y=AnAufkl, colour = TG_KG, group=Bundesland))+ geom_line()+scale_color_manual(values = c('red','gray62','gray62','seagreen3', 'seagreen4'))+ ggtitle("Entwiklung der erklärten Fälle insgesamt in deutschen Bundesländer von 2013 bis 2020") +  xlab("Jahre") + ylab("Zahl der erklärten Fälle insgesamt")
GG4.4
```

RESULTS:
GG4.1 und DS4.2: Alle Länder haben eine stabilen Verlauf, außer NRW und Bayern. NRW hat die gröste Anzahl der erklärten Fälle insgesamt, sinkt abe dem Jahr 2015. Bayern steigt im dem Jahr 2015 und kommt wider auf dem selben Nivea bei 2018. 
GG4.3 und GG4.4: Die Vertilung von den Gruppen folgt keinem Muster. Mann könnte vermuten, dass die Gruppe 3 und 4 eher in der unteren Häften während die Gruppe 0,1 und 2 sich bei der oberen Hälfte bewegen.

```{r}
###  for each Bundesland the development of Erklärung over the years(with Deut and without Deut)
DS5.1 <- LF%>%filter(Straftat == "Straftaten insgesamt")
GG5.1 <- ggplot(DS5.1, aes(x=Jahr, y=TeilAufkl, colour = Bundesland, group=Bundesland))+ geom_line()+ ggtitle("Entwiklung der Anteil der erklärten Fälle insgesamt in deutschen Bundesländer von 2013 bis 2020") +  xlab("Jahre") + ylab("Anteil der erklärten Fälle insgesamt")
GG5.1

DS5.2 <- LF%>%filter(Straftat == "Straftaten insgesamt" & Bundesland !="Deut")
GG5.2 <- ggplot(DS5.2, aes(x=Jahr, y=TeilAufkl, colour = Bundesland, group=Bundesland))+ geom_line()+ ggtitle("Entwiklung der Anteil der erklärten Fälle insgesamt in deutschen Bundesländer von 2013 bis 2020") +  xlab("Jahre") + ylab("Anteil der erklärten Fälle insgesamt")
GG5.2
GG5.3 <- ggplot(DS5.2, aes(x=Jahr, y=TeilAufkl, colour = TG_KG, group=Bundesland))+ geom_line()+ ggtitle("Entwiklung der Anteil der erklärten Fälle insgesamt in deutschen Bundesländer von 2013 bis 2020") +  xlab("Jahre") + ylab("Anteil der erklärten Fälle insgesamt")
GG5.3
GG5.4 <- ggplot(DS5.2, aes(x=Jahr, y=TeilAufkl, colour = TG_KG, group=Bundesland))+ geom_line()+scale_color_manual(values = c('red','gray62','gray62','seagreen3', 'seagreen4'))+ ggtitle("Entwiklung der Anteil der erklärten Fälle insgesamt in deutschen Bundesländer von 2013 bis 2020") +  xlab("Jahre") + ylab("Anteil der erklärten Fälle insgesamt")
GG5.4

```

RESULTS:
GG5.1 und DS5.2: Alle Länder haben einen relativen stabilen Verlauf, außer Bayern. Bayern steigt im dem Jahr 2015 und kommt wider auf dem selben Nivea bei 2018. Ab 2018 steigt die Kurve wieder.
GG5.3 und GG5.4: Die Vertilung von den Gruppen folgt keinem Muster. 

```{r}
# Straftaten for each Years:
S13 <- unique(LF2013$IDStraftat)
S14 <- unique(LF2014$IDStraftat)
S15 <- unique(LF2015$IDStraftat)
S16 <- unique(LF2016$IDStraftat)
S17 <- unique(LF2017$IDStraftat)
S18 <- unique(LF2018$IDStraftat)
S19 <- unique(LF2019$IDStraftat)
S20 <- unique(LF2020$IDStraftat)

# Number of Straftaten for each Years:
length(S13)
length(S14)
length(S15)
length(S16)
length(S17)
length(S18)
length(S19)
length(S20)

# compare the Straftaten for each year:
S <- intersect(intersect(intersect(intersect(intersect(intersect(intersect(S13, S14), S15), S16), S17), S18),S19), S20)

```

Es gibt insgesamt 885 Formen von STraftaten, die über den Jahren stabil ist

```{r}
# development of Straftaten grouped by Straftaten
### consider only the comulative Straftaten Gruppen and the sum of all of them (Straftaten insgesamt) - Diagram
DS6 <- LF%>%filter(Bundesland =="Deut")
DS6.1 <- DS6%>%filter(IDStraftat =="------"| 
                      IDStraftat =="000000"|  
                      IDStraftat =="100000"| 
                      IDStraftat =="200000"|  
                      IDStraftat =="****00"| 
                      IDStraftat =="500000"| 
                      IDStraftat =="600000"| 
                      IDStraftat =="700000")
GG6.1.1 <- ggplot(DS6.1, aes(x=Jahr, y=AnErfFaelle, colour = StraftatGruppe, group=IDStraftat))+ geom_line()+ ggtitle("Entwiklung der Straftaten insgesamt in Deutschland von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der Straftaten insgesamt ")
GG6.1.1

GG6.1.2 <- ggplot(DS6.1, aes(x=Jahr, y=AnVersuche, colour = StraftatGruppe, group=IDStraftat))+ geom_line()+ ggtitle("Entwiklung der Versuche insgesamt in Deutschland von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der Versuche insgesamt ")
GG6.1.2

GG6.1.3 <- ggplot(DS6.1, aes(x=Jahr, y=TeilVersuche, colour = StraftatGruppe, group=IDStraftat))+ geom_line()+ ggtitle("Entwiklung der Anteil der Versuche insgesamt in Deutschland von 2013 bis 2020") +  xlab("Jahre") + ylab("Anteil  der Straftaten insgesamt ")
GG6.1.3

GG6.1.4 <- ggplot(DS6.1, aes(x=Jahr, y=AnAufkl, colour = StraftatGruppe, group=IDStraftat))+ geom_line()+ ggtitle("Entwiklung der erklärten Fälle insgesamt in Deutschland von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der erklärten Fälle insgesamt ")
GG6.1.4

GG6.1.5 <- ggplot(DS6.1, aes(x=Jahr, y=TeilAufkl, colour = StraftatGruppe, group=IDStraftat))+ geom_line()+ ggtitle("Entwiklung der Anteil der erklärten Fälle insgesamt in Deutschland von 2013 bis 2020") +  xlab("Jahre") + ylab("Anteil der erklärten Fälle insgesamt ")
GG6.1.5


### consider only the comulative Straftaten Gruppen without the sum of all of them (Straftaten insgesamt) - Diagram
DS6.2  <- DS6%>%filter(IDStraftat =="000000"|  
                      IDStraftat =="100000"| 
                      IDStraftat =="200000"|  
                      IDStraftat =="****00"| 
                      IDStraftat =="500000"| 
                      IDStraftat =="600000"| 
                      IDStraftat =="700000")
GG6.2.1 <- ggplot(DS6.2, aes(x=Jahr, y=AnErfFaelle, colour = StraftatGruppe, group=IDStraftat))+ geom_line()+ggtitle("Entwiklung der Straftaten insgesamt insgesamt in Deutschland von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der Straftaten insgesamt ")
GG6.2.1

GG6.2.2 <- ggplot(DS6.2, aes(x=Jahr, y=AnVersuche, colour = StraftatGruppe, group=IDStraftat))+ geom_line()+ggtitle("Entwiklung der Versuche insgesamt in Deutschland von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der Vesuche insgesamt ")
GG6.2.2

GG6.2.3 <- ggplot(DS6.2, aes(x=Jahr, y=TeilVersuche, colour = StraftatGruppe, group=IDStraftat))+ geom_line()+ggtitle("Entwiklung der Anteil der Versuche insgesamt in Deutschland von 2013 bis 2020") +  xlab("Jahre") + ylab("Anteil der Versuche insgesamt ")
GG6.2.3

GG6.2.4 <- ggplot(DS6.2, aes(x=Jahr, y=AnAufkl, colour = StraftatGruppe, group=IDStraftat))+ geom_line()+ggtitle("Entwiklung der Anzahl der erklärten Fälle insgesamt in Deutschland von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der erklärten Fälle insgesamt ")
GG6.2.4

GG6.2.5 <- ggplot(DS6.2, aes(x=Jahr, y=TeilAufkl, colour = StraftatGruppe, group=IDStraftat))+ geom_line()+ ggtitle("Entwiklung der Anteil der erklärten Fälle insgesamt in Deutschland von 2013 bis 2020") +  xlab("Jahre") + ylab("Anteil der erklärten Fälle insgesamt ")
GG6.2.5

```

Diebstahl und Strafrechtliche Nebengesetze haben einen Besonderen Verlauf

```{r}

# for the Straftaten Diebstahl und Strafrechtliche Nebengesetze
### overview on Strafrechtliche Nebengesetze 
DS8 <- LF%>%filter(IDStraftat == "700000" & Bundesland != "Deut")
GG8.1<- ggplot(DS8, aes(x=Jahr, y=AnErfFaelle, colour = Bundesland, group=Bundesland))+ geom_line()+ ggtitle("Entwiklung der Strafrechtliche Nebengesetze in deutschen Bundesländern von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der Strafrechtliche Nebengesetze")
GG8.1
### overview on Diebstahl
DS8 <- LF%>%filter(IDStraftat == "****00" & Bundesland != "Deut")
GG8.2<- ggplot(DS8, aes(x=Jahr, y=AnErfFaelle, colour = Bundesland, group=Bundesland))+ geom_line()+ ggtitle("Entwiklung von Diebstahl  in deutschen Bundesländern von 2013 bis 2020") +  xlab("Jahre") + ylab("Anzahl der Diebstahle")
GG8.2

```

GG8.1: Bayern ist nicht das einzige Land, für das in den Jahren 2015 und 2016 mehre Verstöße gegen Strafrechtliche Nebengesetze gibt. 

GG8.2: Hat einen ähnlichen Verlauf über allen Länder hinweg hinweg. 

TO-DO: für alle Länder für die Jahren 2015 und 2016 Intepolation is needed --> 3_kompletteAnalyseINTERPOL

```{r}
### consider only the comulative Straftaten Gruppen and the sum of all of them (Straftaten insgesamt) - Table
colnames(DS6.1)

DS6.3.1 <- select(DS6.1, IDStraftat, Jahr, AnErfFaelle)
DS6.3.1 <-  reshape(DS6.3.1, idvar = "IDStraftat", timevar = "Jahr", direction = "wide")

DS6.3.2 <- select(DS6.1, IDStraftat, Jahr, AnVersuche)
DS6.3.2 <-  reshape(DS6.3.2, idvar = "IDStraftat", timevar = "Jahr", direction = "wide")

DS6.3.3 <- select(DS6.1, IDStraftat, Jahr, TeilVersuche)
DS6.3.3 <-  reshape(DS6.3.3, idvar = "IDStraftat", timevar = "Jahr", direction = "wide")

DS6.3.4 <- select(DS6.1, IDStraftat, Jahr, AnAufkl)
DS6.3.4 <-  reshape(DS6.3.4, idvar = "IDStraftat", timevar = "Jahr", direction = "wide")

DS6.3.5 <- select(DS6.1, IDStraftat, Jahr, TeilAufkl)
DS6.3.5 <-  reshape(DS6.3.5, idvar = "IDStraftat", timevar = "Jahr", direction = "wide")
```

Save the Dtaframe so far

```{r}
saveRDS(LF, file="1LF.rds")
saveRDS(LSO, file="1LSO.rds")
```


# 5. Analysis

### 5.1 create Dataframe
Create new dataframe BKA on the basis of the Dataframe LF, which has a wide format and can be used for the analysis
```{r}
# divide and rejoin in wide format:
### colomn names
colnames(LF)

### keep only relevant variables
BKA <- select(LF, IDStraftat, Straftat, Bundesland,Jahr, AnErfFaelle, AnVersuche, TeilVersuche, AnAufkl, TeilAufkl, TG_KG, TG_CG2019, TG_CG2020, IDbl)

### divide the dataframe by ID_Straftat and rejoin in wide format
T1 <- filter(BKA, IDStraftat =="------")
T2 <- filter(BKA, IDStraftat =="000000")
T3 <- filter(BKA, IDStraftat =="100000")
T4 <- filter(BKA, IDStraftat =="200000")
T5 <- filter(BKA, IDStraftat =="****00")
T6 <- filter(BKA, IDStraftat =="500000")
T7 <- filter(BKA, IDStraftat =="600000")
T8 <- filter(BKA, IDStraftat =="700000")

colnames(T1)[5:9] <- paste("StrIns", colnames(T1[,c(5:9)]), sep = "_")
colnames(T2)[5:9] <- paste("StrggLeben", colnames(T2[,c(5:9)]), sep = "_")
colnames(T3)[5:9] <- paste("StrggSexSb", colnames(T3[,c(5:9)]), sep = "_")
colnames(T4)[5:9] <- paste("StrggperFr", colnames(T4[,c(5:9)]), sep = "_")
colnames(T5)[5:9] <- paste("Dieb", colnames(T5[,c(5:9)]), sep = "_")
colnames(T6)[5:9] <- paste("VerFaelDel", colnames(T6[,c(5:9)]), sep = "_")
colnames(T7)[5:9] <- paste("SonstStr", colnames(T7[,c(5:9)]), sep = "_")
colnames(T8)[5:9] <- paste("StrNebGes", colnames(T8[,c(5:9)]), sep = "_")

T1[1:2] <- NULL  
T2[1:2] <- NULL  
T3[1:2] <- NULL  
T4[1:2] <- NULL  
T5[1:2] <- NULL  
T6[1:2] <- NULL  
T7[1:2] <- NULL  
T8[1:2] <- NULL  

BKA <- Reduce(inner_join, list(T1, T2, T3, T4, T5, T6, T7, T8 ))

### keep only the 16 Bundesländer
BKA <- subset(BKA, Bundesland != "Deut")

#check
view(BKA)

```

Create new dataframe SO on the bsis of LSO, which contains only the relevant variables
```{r}
SO <- select(LSO, Jahr,Bundesland, ArbeitslosenQuote, Gini, WahlBet, AusländerTeil, FertiliaetTeil, Dichte, SiedVerkFlschTeil, GrueneTeil, FDPTeil, LinkeTeil, SGBXIITeil, ErwerbMitAkaAbschTeil, ErwerbDienstTeil, WohnEinw, von25bis30JTeil, bis18JTeil, ZweiZimmerTeil, BeschAoWoTeil)

#check
view(SO)

```

Merge Together the Datframes SO and BKA into the dataframe Data, ready for the Analysis
```{r}
# check if they are mergeble
### Bundesland
unique(BKA$Bundesland)
unique(SO$Bundesland)
setdiff(unique(SO$Bundesland), unique(BKA$Bundesland))
### Jahr 
setdiff(unique(SO$Jahr), unique(BKA$Jahr))

#join
Data <- Reduce(inner_join, list(SO, BKA))

#check 
view(Data)
```

Save the Dataframes
```{r}
saveRDS(BKA, file="1BKA.rds")
saveRDS(SO, file="1SO.rds")
saveRDS(Data, file="1Data.rds")
```

### 5.2 Analysis with Synthetic Control Methods in Comparative Case Studies

Reload the Data
```{r}
rm(list = ls())
BKA <- readRDS("1BKA.rds")
SO <- readRDS("1SO.rds")
Data <- readRDS("1Data.rds")
```


### 5.2.1 Anzahl der Straftaten Insgesamt

Data preparation:
We prepare our Data in order to be able to use the main function synth(). In this case we consider the Data from 2013 till 2019. Reasons for that are: more units in the pool of the CG and Corona crisis.
```{r}
Data <- as.data.frame(Data)
View(Data)
is.data.frame(Data)
colnames(Data)

dataprep.outAnFaelle <-dataprep(
                       foo =Data,
                       predictors = c("BeschAoWoTeil",
                                      "ErwerbMitAkaAbschTeil", 
                                      "ArbeitslosenQuote", 
                                      "Gini", 
                                      "FertiliaetTeil", 
                                      "Dichte",
                                      "SGBXIITeil") ,
                       predictors.op = "mean",
                       time.predictors.prior = 2013:2017 ,
                       special.predictors = list(
                         list("WahlBet" ,seq(2013,2017,4), "mean"), 
                         list("AusländerTeil", 2013, "mean"), 
                         list("SiedVerkFlschTeil", 2013, "mean"),
                         list("GrueneTeil", seq(2013,2017,4),"mean"),
                         list("FDPTeil", seq(2013,2017,4), "mean"),
                         list("LinkeTeil", seq(2013,2017,4), "mean"),
                         list("ErwerbDienstTeil", 2013, "mean"),
                         list("WohnEinw", 2013, "mean"),
                         list("von25bis30JTeil", 2013, "mean"),
                         list("bis18JTeil", 2013, "mean"),
                         list("ZweiZimmerTeil", 2013, "mean")),
                       dependent = "StrIns_AnErfFaelle",
                       unit.variable = "IDbl",
                       unit.names.variable = "Bundesland",
                       time.variable = "Jahr",
                       treatment.identifier = 1,
                       controls.identifier = c(9:16),
                       time.optimize.ssr = 2013:2017,
                       time.plot = 2013:2019
                       )

```

Exploring the Data:
```{r}
# Treatment group - mean of the controllvariables 
dataprep.outAnFaelle$X1
# Control group - mean of the controllvariables
dataprep.outAnFaelle$X0
# Treatment group - Dependent variable 
dataprep.outAnFaelle$Z1
# Control group - Dependent variable
dataprep.outAnFaelle$Z0


```

synth() function:
```{r}
synth.outAnFaelle <- synth(data.prep.obj = dataprep.outAnFaelle,method = "BFGS")
synth.outAnFaelle
```

plots and tables:
```{r}
gapsAnFaelle <- dataprep.outAnFaelle$Y1plot - (dataprep.outAnFaelle$Y0plot %*% synth.outAnFaelle$solution.w)
gapsAnFaelle

synth.tablesAnFaelle <- synth.tab(dataprep.res = dataprep.outAnFaelle, synth.res = synth.outAnFaelle)
names(synth.tablesAnFaelle)
synth.tablesAnFaelle$tab.loss
synth.tablesAnFaelle$tab.v
synth.tablesAnFaelle$tab.w
synth.tablesAnFaelle$tab.pred


path.plot(synth.res = synth.outAnFaelle,
           dataprep.res = dataprep.outAnFaelle,
           Ylab = "Anazhl der Straftaten Insgesamt",
           Xlab = "Jahr",
           Legend = c("Bayern","synthetic Bayern"),
           Legend.position = "bottomright"
           )

gaps.plot(synth.res = synth.outAnFaelle,
           dataprep.res = dataprep.outAnFaelle,
           Ylab = "Anazhl der Straftaten Insgesamt",
           Xlab = "Jahr",
           Main = NA
           )
```

Placebo Test
```{r}
# data preparation
Data <- as.data.frame(Data)
dataprep.outAnFaellePLACEBO <-dataprep(
                       foo =Data,
                       predictors = c("BeschAoWoTeil",
                                      "ErwerbMitAkaAbschTeil", 
                                      "ArbeitslosenQuote", 
                                      "Gini", 
                                      "FertiliaetTeil", 
                                      "Dichte",
                                      "SGBXIITeil") ,
                       predictors.op = "mean",
                       time.predictors.prior = 2013:2017 ,
                       special.predictors = list(
                         list("WahlBet" ,seq(2013,2017,4), "mean"), 
                         list("AusländerTeil", 2013, "mean"), 
                         list("SiedVerkFlschTeil", 2013, "mean"),
                         list("GrueneTeil", seq(2013,2017,4),"mean"),
                         list("FDPTeil", seq(2013,2017,4), "mean"),
                         list("LinkeTeil", seq(2013,2017,4), "mean"),
                         list("ErwerbDienstTeil", 2013, "mean"),
                         list("WohnEinw", 2013, "mean"),
                         list("von25bis30JTeil", 2013, "mean"),
                         list("bis18JTeil", 2013, "mean"),
                         list("ZweiZimmerTeil", 2013, "mean")),
                       dependent = "StrIns_AnErfFaelle",
                       unit.variable = "IDbl",
                       unit.names.variable = "Bundesland",
                       time.variable = "Jahr",
                       treatment.identifier = 10,
                       controls.identifier = c(9,11:16),
                       time.optimize.ssr = 2013:2017,
                       time.plot = 2013:2019
                       )

# function
synth.outAnFaellePLACEBO <- synth(data.prep.obj = dataprep.outAnFaellePLACEBO,method = "BFGS")
synth.outAnFaellePLACEBO

#path plot
path.plot(synth.res = synth.outAnFaellePLACEBO,
           dataprep.res = dataprep.outAnFaellePLACEBO,
           Ylab = "Anazhl der Straftaten Insgesamt",
           Xlab = "Jahr",
           Legend = c("Bayern","synthetic Bayern"),
           Legend.position = "bottomright"
           )
```

Gaps Test - WORKING IN PROGRESS
```{r}
store <- matrix(NA,length(2013:2019),16)
colnames(store) <- unique(Data$Bundesland)
Data <- as.data.frame(Data)

# run placebo test
for(iter in 1:16)
 {
 dataprep.outAnFaelleGAPS <-dataprep(
                       foo =Data,
                       predictors = c("BeschAoWoTeil",
                                      "ErwerbMitAkaAbschTeil", 
                                      "ArbeitslosenQuote", 
                                      "Gini", 
                                      "FertiliaetTeil", 
                                      "Dichte",
                                      "SGBXIITeil") ,
                       predictors.op = "mean",
                       time.predictors.prior = 2013:2017 ,
                       special.predictors = list(
                         list("WahlBet" ,seq(2013,2017,4), "mean"), 
                         list("AusländerTeil", 2013, "mean"), 
                         list("SiedVerkFlschTeil", 2013, "mean"),
                         list("GrueneTeil", seq(2013,2017,4),"mean"),
                         list("FDPTeil", seq(2013,2017,4), "mean"),
                         list("LinkeTeil", seq(2013,2017,4), "mean"),
                         list("ErwerbDienstTeil", 2013, "mean"),
                         list("WohnEinw", 2013, "mean"),
                         list("von25bis30JTeil", 2013, "mean"),
                         list("bis18JTeil", 2013, "mean"),
                         list("ZweiZimmerTeil", 2013, "mean")),
                       dependent = "StrIns_AnErfFaelle",
                       unit.variable = "IDbl",
                       unit.names.variable = "Bundesland",
                       time.variable = "Jahr",
                       treatment.identifier = iter,
                       controls.identifier = c(1:16)[-iter],
                       time.optimize.ssr = 2013:2017,
                       time.plot = 2013:2019
                       )


# run synth
synth.outAnFaelleGAPS <- synth(
                   data.prep.obj = dataprep.outAnFaelleGAPS,
                   method = "BFGS"
                   )

# store gaps
store[,iter] <- dataprep.outAnFaelleGAPS$Y1plot - (dataprep.outAnFaelleGAPS$Y0plot %*% synth.outAnFaelleGAPS$solution.w)
}

# now do figure
data <- store
rownames(data) <- 2013:2019

# Set bounds in gaps data
gap.start     <- 1
gap.end       <- nrow(data)
years         <- 2013:2019
gap.end.pre  <- which(rownames(data)=="2018")

#  MSPE Pre-Treatment
mse  <- apply(data[ gap.start:gap.end.pre,]^2,2,mean)
Bay.mse <- as.numeric(mse[16])
# Exclude states with 5 times higher MSPE than basque
data <- data[,mse<5*Bay.mse]
Cex.set <- .75

# Plot
plot(years,data[gap.start:gap.end,which(colnames(data)=="Bayern")],
     ylim=c(-2,2),xlab="year",
     xlim=c(2013:2019),ylab="gap in Kriminality",
     type="l",lwd=2,col="black",
     xaxs="i",yaxs="i")

# Add lines for control states
for (i in 1:ncol(data)) { lines(years,data[gap.start:gap.end,i],col="gray") }

## Add Basque Line
lines(years,data[gap.start:gap.end,which(colnames(data)=="Bayern")],lwd=2,col="black")

# Add grid
abline(v=1970,lty="dotted",lwd=2)
abline(h=0,lty="dashed",lwd=2)
legend("bottomright",legend=c("Bayern","control regions"),
lty=c(1,1),col=c("black","gray"),lwd=c(2,1),cex=.8)
arrows(1967,-1.5,1968.5,-1.5,col="black",length=.1)
text(1961.5,-1.5,"Gesetz",cex=Cex.set)
abline(v=2013)
abline(v=2019)
abline(h=-2)
abline(h=2)


```

##### 5.2.1 Anazhl der Versuche der Straftaten Insgesamt
Data preparation:
```{r}

# Datapreparation
### we prepare our Data in order to be able to use the main function synth(). IN this case we consider the Data from 2013 till 2019. Reasons for that are: more units in the pool of the CG and Corona crisis. 
Data <- as.data.frame(Data)
View(Data)
is.data.frame(Data)

dataprep.outAnVers <-dataprep(
                       foo =Data,
                       predictors = c("BeschAoWoTeil",
                                      "ErwerbMitAkaAbschTeil", 
                                      "ArbeitslosenQuote", 
                                      "Gini", 
                                      "FertiliaetTeil", 
                                      "Dichte",
                                      "SGBXIITeil") ,
                       predictors.op = "mean",
                       time.predictors.prior = 2013:2017 ,
                       special.predictors = list(
                         list("WahlBet" ,seq(2013,2017,4), "mean"), 
                         list("AusländerTeil", 2013, "mean"), 
                         list("SiedVerkFlschTeil", 2013, "mean"),
                         list("GrueneTeil", seq(2013,2017,4),"mean"),
                         list("FDPTeil", seq(2013,2017,4), "mean"),
                         list("LinkeTeil", seq(2013,2017,4), "mean"),
                         list("ErwerbDienstTeil", 2013, "mean"),
                         list("WohnEinw", 2013, "mean"),
                         list("von25bis30JTeil", 2013, "mean"),
                         list("bis18JTeil", 2013, "mean"),
                         list("ZweiZimmerTeil", 2013, "mean")),
                       dependent = "StrIns_AnVersuche",
                       unit.variable = "IDbl",
                       unit.names.variable = "Bundesland",
                       time.variable = "Jahr",
                       treatment.identifier = 1,
                       controls.identifier = c(9:16),
                       time.optimize.ssr = 2013:2017,
                       time.plot = 2013:2019
                       )



```

Exploring the Data:
```{r}
# Treatment group - mean of the controllvariables 
dataprep.outAnVers$X1
# Control group - mean of the controllvariables
dataprep.outAnVers$X0
# Treatment group - Dependent variable 
dataprep.outAnVers$Z1
# Control group - Dependent variable
dataprep.outAnVers$Z0

```

synth() function:
```{r}
synth.outAnVers <- synth(data.prep.obj = dataprep.outAnVers,method = "BFGS")
synth.outAnVers
```

plots and tables:
```{r}
gapsAnVers <- dataprep.outAnVers$Y1plot - (dataprep.outAnVers$Y0plot %*% synth.outAnVers$solution.w)
gapsAnVers

synth.tablesAnVers <- synth.tab(dataprep.res = dataprep.outAnVers, synth.res = synth.outAnVers)
names(synth.tablesAnVers)
synth.tablesAnVers$tab.loss
synth.tablesAnVers$tab.v
synth.tablesAnVers$tab.w
synth.tablesAnVers$tab.pred


path.plot(synth.res = synth.outAnVers,
           dataprep.res = dataprep.outAnVers,
           Ylab = "Anazhl der Versuche der Straftaten Insgesamt",
           Xlab = "Jahr",
           Legend = c("Bayern","synthetic Bayern"),
           Legend.position = "bottomright"
           )

gaps.plot(synth.res = synth.outAnVers,
           dataprep.res = dataprep.outAnVers,
           Ylab = "Anazhl der Versuche der Straftaten Insgesamt",
           Xlab = "Jahr",
           Main = NA
           )
```

```{r}
### placebo
```

##### 5.2.1 Teil der Versuche der Straftaten Insgesamt
Data preparation:
```{r}

# Datapreparation
### we prepare our Data in order to be able to use the main function synth(). IN this case we consider the Data from 2013 till 2019. Reasons for that are: more units in the pool of the CG and Corona crisis. 
Data <- as.data.frame(Data)
View(Data)
is.data.frame(Data)

dataprep.outTeilVers <-dataprep(
                       foo =Data,
                       predictors = c("BeschAoWoTeil",
                                      "ErwerbMitAkaAbschTeil", 
                                      "ArbeitslosenQuote", 
                                      "Gini", 
                                      "FertiliaetTeil", 
                                      "Dichte",
                                      "SGBXIITeil") ,
                       predictors.op = "mean",
                       time.predictors.prior = 2013:2017 ,
                       special.predictors = list(
                         list("WahlBet" ,seq(2013,2017,4), "mean"), 
                         list("AusländerTeil", 2013, "mean"), 
                         list("SiedVerkFlschTeil", 2013, "mean"),
                         list("GrueneTeil", seq(2013,2017,4),"mean"),
                         list("FDPTeil", seq(2013,2017,4), "mean"),
                         list("LinkeTeil", seq(2013,2017,4), "mean"),
                         list("ErwerbDienstTeil", 2013, "mean"),
                         list("WohnEinw", 2013, "mean"),
                         list("von25bis30JTeil", 2013, "mean"),
                         list("bis18JTeil", 2013, "mean"),
                         list("ZweiZimmerTeil", 2013, "mean")),
                       dependent = "StrIns_TeilVersuche",
                       unit.variable = "IDbl",
                       unit.names.variable = "Bundesland",
                       time.variable = "Jahr",
                       treatment.identifier = 1,
                       controls.identifier = c(9:16),
                       time.optimize.ssr = 2013:2017,
                       time.plot = 2013:2019
                       )


```

Exploring the Data:
```{r}
# Treatment group - mean of the controllvariables 
dataprep.outTeilVers$X1
# Control group - mean of the controllvariables
dataprep.outTeilVers$X0
# Treatment group - Dependent variable 
dataprep.outTeilVers$Z1
# Control group - Dependent variable
dataprep.outTeilVers$Z0

```

synth() function:
```{r}
synth.outTeilVers <- synth(data.prep.obj = dataprep.outTeilVers,method = "BFGS")
synth.outTeilVers
```

plots and tables:
```{r}
gapsTeilVers <- dataprep.outTeilVers$Y1plot - (dataprep.outTeilVers$Y0plot %*% synth.outTeilVers$solution.w)
gapsTeilVers

synth.tablesTeilVers <- synth.tab(dataprep.res = dataprep.outTeilVers, synth.res = synth.outTeilVers)
names(synth.tablesTeilVers)
synth.tablesTeilVers$tab.loss
synth.tablesTeilVers$tab.v
synth.tablesTeilVers$tab.w
synth.tablesTeilVers$tab.pred


path.plot(synth.res = synth.outTeilVers,
           dataprep.res = dataprep.outTeilVers,
           Ylab = "Teil der Versuche der Straftaten Insgesamt",
           Xlab = "Jahr",
           Legend = c("Bayern","synthetic Bayern"),
           Legend.position = "bottomright"
           )

gaps.plot(synth.res = synth.outTeilVers,
           dataprep.res = dataprep.outTeilVers,
           Ylab = "Teil der Versuche der Straftaten Insgesamt",
           Xlab = "Jahr",
           Main = NA
           )
```

```{r}
### placebo
```

##### 5.2.1 Anzahl der aufgeklärten Straftaten Insgesamt
Data preparation:
```{r}

# Datapreparation
### we prepare our Data in order to be able to use the main function synth(). IN this case we consider the Data from 2013 till 2019. Reasons for that are: more units in the pool of the CG and Corona crisis. 
Data <- as.data.frame(Data)
View(Data)
is.data.frame(Data)

dataprep.outAnErkl <-dataprep(
                       foo =Data,
                       predictors = c("BeschAoWoTeil",
                                      "ErwerbMitAkaAbschTeil", 
                                      "ArbeitslosenQuote", 
                                      "Gini", 
                                      "FertiliaetTeil", 
                                      "Dichte",
                                      "SGBXIITeil") ,
                       predictors.op = "mean",
                       time.predictors.prior = 2013:2017 ,
                       special.predictors = list(
                         list("WahlBet" ,seq(2013,2017,4), "mean"), 
                         list("AusländerTeil", 2013, "mean"), 
                         list("SiedVerkFlschTeil", 2013, "mean"),
                         list("GrueneTeil", seq(2013,2017,4),"mean"),
                         list("FDPTeil", seq(2013,2017,4), "mean"),
                         list("LinkeTeil", seq(2013,2017,4), "mean"),
                         list("ErwerbDienstTeil", 2013, "mean"),
                         list("WohnEinw", 2013, "mean"),
                         list("von25bis30JTeil", 2013, "mean"),
                         list("bis18JTeil", 2013, "mean"),
                         list("ZweiZimmerTeil", 2013, "mean")),
                       dependent = "StrIns_AnAufkl",
                       unit.variable = "IDbl",
                       unit.names.variable = "Bundesland",
                       time.variable = "Jahr",
                       treatment.identifier = 1,
                       controls.identifier = c(9:16),
                       time.optimize.ssr = 2013:2017,
                       time.plot = 2013:2019
                       )



```

Exploring the Data:
```{r}
# Treatment group - mean of the controllvariables 
dataprep.outAnErkl$X1
# Control group - mean of the controllvariables
dataprep.outAnErkl$X0
# Treatment group - Dependent variable 
dataprep.outAnErkl$Z1
# Control group - Dependent variable
dataprep.outAnErkl$Z0

```

synth() function:
```{r}
synth.outAnErkl <- synth(data.prep.obj = dataprep.outAnErkl,method = "BFGS")
synth.outAnErkl
```

plots and tables:
```{r}
gapsAnErkl <- dataprep.outAnErkl$Y1plot - (dataprep.outAnErkl$Y0plot %*% synth.outAnErkl$solution.w)
gapsAnErkl

synth.tablesAnErkl <- synth.tab(dataprep.res = dataprep.outAnErkl, synth.res = synth.outAnErkl)
names(synth.tablesAnErkl)
synth.tablesAnErkl$tab.loss
synth.tablesAnErkl$tab.v
synth.tablesAnErkl$tab.w
synth.tablesAnErkl$tab.pred


path.plot(synth.res = synth.outAnErkl,
           dataprep.res = dataprep.outAnErkl,
           Ylab = "Anzahl der aufgeklärten Straftaten Insgesamt",
           Xlab = "Jahr",
           Legend = c("Bayern","synthetic Bayern"),
           Legend.position = "bottomright"
           )

gaps.plot(synth.res = synth.outAnErkl,
           dataprep.res = dataprep.outAnErkl,
           Ylab = "Anazhl der Straftaten Insgesamt",
           Xlab = "Jahr",
           Main = NA
           )
```

```{r}
### placebo
```

##### 5.2.1 Teil der aufgeklärten Straftaten Insgesamt
Data preparation:
```{r}

# Datapreparation
### we prepare our Data in order to be able to use the main function synth(). IN this case we consider the Data from 2013 till 2019. Reasons for that are: more units in the pool of the CG and Corona crisis. 
Data <- as.data.frame(Data)
View(Data)
is.data.frame(Data)

dataprep.outTeilAufk <-dataprep(
                       foo =Data,
                       predictors = c("BeschAoWoTeil",
                                      "ErwerbMitAkaAbschTeil", 
                                      "ArbeitslosenQuote", 
                                      "Gini", 
                                      "FertiliaetTeil", 
                                      "Dichte",
                                      "SGBXIITeil") ,
                       predictors.op = "mean",
                       time.predictors.prior = 2013:2017 ,
                       special.predictors = list(
                         list("WahlBet" ,seq(2013,2017,4), "mean"), 
                         list("AusländerTeil", 2013, "mean"), 
                         list("SiedVerkFlschTeil", 2013, "mean"),
                         list("GrueneTeil", seq(2013,2017,4),"mean"),
                         list("FDPTeil", seq(2013,2017,4), "mean"),
                         list("LinkeTeil", seq(2013,2017,4), "mean"),
                         list("ErwerbDienstTeil", 2013, "mean"),
                         list("WohnEinw", 2013, "mean"),
                         list("von25bis30JTeil", 2013, "mean"),
                         list("bis18JTeil", 2013, "mean"),
                         list("ZweiZimmerTeil", 2013, "mean")),
                       dependent = "StrIns_TeilAufkl",
                       unit.variable = "IDbl",
                       unit.names.variable = "Bundesland",
                       time.variable = "Jahr",
                       treatment.identifier = 1,
                       controls.identifier = c(9:16),
                       time.optimize.ssr = 2013:2017,
                       time.plot = 2013:2019
                       )


```

Exploring the Data:
```{r}
# Treatment group - mean of the controllvariables 
dataprep.outTeilAufk$X1
# Control group - mean of the controllvariables
dataprep.outTeilAufk$X0
# Treatment group - Dependent variable 
dataprep.outTeilAufk$Z1
# Control group - Dependent variable
dataprep.outTeilAufk$Z0

```

synth() function:
```{r}
synth.outTeilAufk <- synth(data.prep.obj = dataprep.outTeilAufk,method = "BFGS")
synth.outTeilAufk
```

plots and tables:
```{r}
gapsTeilAufk <- dataprep.outTeilAufk$Y1plot - (dataprep.outTeilAufk$Y0plot %*% synth.outTeilAufk$solution.w)
gapsTeilAufk

synth.tablesTeilAufk <- synth.tab(dataprep.res = dataprep.outTeilAufk, synth.res = synth.outTeilAufk)
names(synth.tablesTeilAufk)
synth.tablesTeilAufk$tab.loss
synth.tablesTeilAufk$tab.v
synth.tablesTeilAufk$tab.w
synth.tablesTeilAufk$tab.pred


path.plot(synth.res = synth.outTeilAufk,
           dataprep.res = dataprep.outTeilAufk,
           Ylab = "Teil der aufgeklärten Straftaten Insgesamt",
           Xlab = "Jahr",
           Legend = c("Bayern","synthetic Bayern"),
           Legend.position = "bottomright"
           )

gaps.plot(synth.res = synth.outTeilAufk,
           dataprep.res = dataprep.outTeilAufk,
           Ylab = "Teil der aufgeklärten Straftaten Insgesamt",
           Xlab = "Jahr",
           Main = NA
           )
```

```{r}
### placebo
```



